<!DOCTYPE html>
<html lang="en">
  <head><title>March 27th Service Outage | pnyv dot sh</title><meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Accept-CH" content="DPR,Width,Viewport-Width" />
<meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="apple-mobile-web-app-title" content="pnyv dot sh" />
<meta name="application-name" content="pnyv dot sh" />
<meta name="msapplication-config" content="/favicons/browserconfig.xml" />
<meta name="theme-color" content="#ffffff" />
<meta name="description" content=" /"><meta name="robots" content="noindex, nofollow" />
<meta property="og:title" content="March 27th Service Outage" />
<meta property="og:description" content="As some of you may have noticed, Forestry was down for about 2.5 hours between 23:00 UTC March 27 until 01:30 UTC March 28. In the spirit of full disclosure I&rsquo;d like to explain what happened and why.
Forestry is a Rails application and from time to time the number of migrations we have get unwieldy. Being an application under rapid development, things are constantly changing and migrations are created sometimes daily." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/march-27th-service-outage/" /><meta property="og:image" content="/uploads/2017/12/forestry-outage-2.png" /><meta property="og:image:alt" content="As some of you may have noticed, Forestry was down for about 2.5 hours between 23:00 UTC March 27 until 01:30 UTC March 28. In the spirit of full disclosure I&rsquo;d like to explain what happened and why.
Forestry is a Rails application and from time to time the number of migrations we have get unwieldy. Being an application under rapid development, things are constantly changing and migrations are created sometimes daily." /><meta property="article:published_time" content="2017-03-27T21:25:39&#43;00:00"/>
  <meta property="article:modified_time" content="2017-03-27T21:25:39&#43;00:00"/><meta property="og:locale" content="en" />
<meta property="article:section" content="blog" />
  <meta itemprop="name" content="March 27th Service Outage">
<meta itemprop="description" content="As some of you may have noticed, Forestry was down for about 2.5 hours between 23:00 UTC March 27 until 01:30 UTC March 28. In the spirit of full disclosure I&rsquo;d like to explain what happened and why.
Forestry is a Rails application and from time to time the number of migrations we have get unwieldy. Being an application under rapid development, things are constantly changing and migrations are created sometimes daily."><meta itemprop="datePublished" content="2017-03-27T21:25:39&#43;00:00" /><meta itemprop="dateModified" content="2017-03-27T21:25:39&#43;00:00" /><meta itemprop="wordCount" content="491"><meta itemprop="image" content="/uploads/2017/12/forestry-outage-2.png">
  <meta itemprop="keywords" content="chris-macrae,colin-garvey,dj-walker,forestry-team,forestryio,jordan-patterson,michael-soolee,régis-philibert,scott-gallant,sebastian-engels,team-forestry,beyond-static,cicd,cms,company,development-tools,frontend-friday,hugo,jekyll,static-sites,,blocks,frontend-friday,hugo,jekyll,webpack," /><meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image:src" content="/uploads/2017/12/forestry-outage-2.png"/><meta name="twitter:title" content="March 27th Service Outage"/>
<meta name="twitter:description" content="As some of you may have noticed, Forestry was down for about 2.5 hours between 23:00 UTC March 27 until 01:30 UTC March 28. In the spirit of full disclosure I&rsquo;d like to explain what happened and why.
Forestry is a Rails application and from time to time the number of migrations we have get unwieldy. Being an application under rapid development, things are constantly changing and migrations are created sometimes daily."/><meta name="twitter:site" content="@forestryio"/><meta name="generator" content="Hugo 0.42.1" />
<link rel="stylesheet" href="/css/styles.min.css?8bc5e92b0a0323c085841879264ee2f8" type="text/css" /><link rel="manifest" href="/favicons/manifest.json" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16" />
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#00c7b7" />
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KL5HP9Q');</script>



<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "url": "/",
    "logo": "/img/forestry-full.svg",
    "sameAs": ["https://www.twitter.com/forestryio"]
  }
  </script>
</head>
  <body class="section-blog kind-page type-blog ">
    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KL5HP9Q" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <header class="header container">
  <div class="left-block">
    <a href="/" title="Go to homepage" class="logo"></a>
  </div>
  <div class="right-block"><div class="search">
      <input type="search" name="search" placeholder="Search the blog..." class="search--input">
    </div><nav class="nav">
      <div class="nav-content">
        <a href="/" class="mini-nav--logo"></a>
        <ul class="main-nav-items"><li>
              <a href="/pricing/" class="nav-item">Pricing</a>
            </li><li>
              <a href="/docs/welcome/" class="nav-item">Docs</a>
            </li><li>
              <a href="/blog/" class="nav-item">Blog</a>
            </li><li data-signed-out="true">
              <a class="signup-button button small primary" href="https://app.forestry.io/signup">Sign up</a>
            </li></ul></div>
    </nav>
    <div class="mini-nav--toggle"><img class="toggle-open" src="/img/navtoggle-open.svg" alt="Open nav"><img class="toggle-close" src="/img/navtoggle-close.svg" alt="Close nav">
    </div>
  </div>
</header><div id="root"></div>
  <div id="modal-root"></div>
  <main id="post-container" class="single-post"><div class="post--feature-image">
            
  <img src="/uploads/2017/12/forestry-outage-2.png" data-src="/uploads/2017/12/forestry-outage-2.png" alt="March 27th Service Outage" title="/uploads/2017/12/forestry-outage-2.png" class="lazyload" />
        </div><div class="container">
      <h1 class="post--title">March 27th Service Outage</h1>
      <div class="post--meta"><div class="author">
          <span class="post--meta-label">Written by</span><a href="/authors/scott-gallant/" class="author--wrapper">
                <div class="author--avatar">
                  <img src="/uploads/2017/12/Scott_Gallant_square.png" alt="Scott Gallant">
                </div>
                <div class="author--info">
                  <span class="author--name">Scott Gallant</span>
                  <span class="author--title">CEO &amp; co-founder</span>
                </div>
              </a></div><div class="post--info">
          <span class="post--meta-label">Posted on</span>
          <span class="post--date">March 27, 2017</span><span>in 
            <a href="/categories/company" class="post--category" data-category="company">
              Company
            </a>,
            <a href="/categories/cms" class="post--category" data-category="cms">
              Cms
            </a></span></div>
      </div>

      <div class="md-content">
        
  
  
  
  
  
  
  
  
  
  
    
  
    
  
  <p>As some of you may have noticed, Forestry was down for about 2.5 hours between 23:00 UTC March 27 until 01:30 UTC March 28. In the spirit of full disclosure I&rsquo;d like to explain what happened and why.</p>

<p>Forestry is a Rails application and from time to time the number of migrations we have get unwieldy. Being an application under rapid development, things are constantly changing and migrations are created sometimes daily. To keep this every growing list of files at bay we use a tool called 
<a href="https://github.com/jalkoby/squasher" style="font-size: 1rem; background-color: rgb(255, 255, 255);">squasher</a>
<span style="font-size: 1rem;">&nbsp;to squash our migrations into a single migration.</span></p>

<p>The way squasher works is by taking the current state of the database and adding it to a migration with a filename that reflects the most recent migration that has run. This prevents the squashed migration from running when the database is migrated. This migration shouldn&rsquo;t run because, as it turns out, it will delete your entire database. The create_table statements are suffixed with <code>force: :cascade</code> which drops the table and all the related tables then recreates them. I think you can see where I am going.</p>

<p>I ran squasher on our migrations in dry run mode (as I have done before) to ensure that everything looked ok. Dry run mode creates the new squashed migration so that it can be inspected. My mistake was that I forgot to delete the migration that the dry run created before I ran it for real. On the subsequent run squasher picked up on the new migration, which didn&rsquo;t have a record in the database because it had never been run. The new squashed migration now had a name that did not exist in our production database and so when it ran, wiped our entire production database clean. The migration was run in development, but it was on a clean database so the issue wasn&rsquo;t noticed. And frankly, I wasn&rsquo;t worried because &ldquo;I&rsquo;ve done this before&rdquo;.</p>

<p>But&hellip; this is why we have backups. Our production database runs on 
<a href="https://aws.amazon.com/rds/" style="font-size: 1rem; background-color: rgb(255, 255, 255);">Amazon&nbsp;RDS</a>
<span style="font-size: 1rem;">&nbsp;in a multi-az deployment. By the time the issue was noticed, the changes had already propagated to the failover instance so we had to go back to a point-in-time restore. So we took the site offline and searched our logs to find the most recent successful API request (this was the longest part). Once we found that, it was just a few clicks (and some waiting) to get a restored copy of the database back up and running. All in all, we lost &lt; 1min worth of data.</span></p>

<p>Once service was restored, we had a backlog jobs that needed to be processed. You may have experienced slow publish/preview/import times while we churned through them. After about 30 mins of Forestry coming back online everything was back to normal.</p>

<p>TLDR; Accidentally deleted our production database by way of a bad migration so we had to restore from a backup.</p>

<p><span style="font-size: .8em;"><em>Thanks to
<a href="https://thenounproject.com/rockicon/">Rockicon</a> for the great DB icon on this post!</em></span></p>

      </div>

      <hr /><div class="post--about"></div><aside class="social-sharing">
  <h2 class="social-sharing--title">Share this article</h2>
  <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_reddit"></a>
    <a class="a2a_button_hacker_news"></a>
  </div>
  <script>
  var a2a_config = a2a_config || {};
  a2a_config.linkname = "March 27th Service Outage";
  a2a_config.linkurl = "https://forestry.io\/blog\/march-27th-service-outage\/";
  </script>
  <script async src="https://static.addtoany.com/menu/page.js"></script>
</aside>
<div class="post--feedback">
        <p><small>Caught a mistake or want to contribute to the blog? Edit this page on <a href="https://github.com/forestryio/forestry.io/edit/master/hugo/content/blog/march-27th-service-outage.md" target="_blank">Github</a>!</small></p>
      </div></div><aside class="post--related">
      <div class="container">
        <h2 class="post--related-title">Other Articles You Might Like</h2><article class="blog-post column">
    <div class="post-meta">
        <span class="post-date">October 20, 2017</span>
        <span class="post-category" data-category="blog"><span>in 
                <a href="/categories/company" class="post--category" data-category="company">
                Company
                </a></span></span>
    </div>
    <a href="/blog/join-our-slack-community/"><h2 class="post-title">Join our Slack community</h2></a>
    <p class="post-excerpt">Want to chat with the Forestry.io community about static sites, best-practices, features, and more? Join the slack community here …
        </p>
</article><article class="blog-post column">
    <div class="post-meta">
        <span class="post-date">October 12, 2017</span>
        <span class="post-category" data-category="blog"><span>in 
                <a href="/categories/cms" class="post--category" data-category="cms">
                Cms
                </a></span></span>
    </div>
    <a href="/blog/discontinuing-zip-sites/"><h2 class="post-title">Discontinuing Zip-imported Sites</h2></a>
    <p class="post-excerpt">Letting developers import a site from a zip archive is a feature that a lot of our users have made use of. However, with our strong focus on …
        </p>
</article><article class="blog-post column">
    <div class="post-meta">
        <span class="post-date">August 30, 2017</span>
        <span class="post-category" data-category="blog"><span>in 
                <a href="/categories/cms" class="post--category" data-category="cms">
                Cms
                </a></span></span>
    </div>
    <a href="/blog/introducing-forestry-config-files/"><h2 class="post-title">Introducing Forestry Config Files</h2></a>
    <p class="post-excerpt">Introducing Forestry Config Files Last month we released a big update to Front Matter Templates, which provided an unprecedented level of …
        </p>
</article><article class="blog-post column">
    <div class="post-meta">
        <span class="post-date">July 26, 2017</span>
        <span class="post-category" data-category="blog"><span>in 
                <a href="/categories/cms" class="post--category" data-category="cms">
                Cms
                </a></span></span>
    </div>
    <a href="/blog/wysiwyg-formatting-in-front-matter/"><h2 class="post-title">WYSIWYG Formatting in Front Matter</h2></a>
    <p class="post-excerpt">This week we’ve got a small, but very useful update we&rsquo;re excited to share with you.
WYSIWYG Formatting in Textareas Our textarea …
        </p>
</article></div>
    </aside></main><section class="section section-cta center" id="footer-cta">
  <div class="container">
    <h2 class="section--title">Want to hear it first?</h2>
    <p class="section--sub is-center">Subscribe to our newsletter to get the posts directly in your inbox as they get posted.</p>
    <br><br><form action="https://www.getrevue.co/profile/forestryio/add_subscriber" method="post" id="revue-form" name="revue-form" target="_blank">
      <div class="newsletter-signup--field form--joined form--large form--center">
        <input class="revue-form-field" placeholder="your.name@example.com" type="email" name="member[email]" id="member_email">
        <button type="submit" value="Subscribe" name="member[subscribe]" id="member_submit" class="button primary small">Subscribe</button>
      </div>
    </form></div>
</section>
<footer class="footer">
  <div class="container">
    <div class="columns">
      <div class="column">
        <a href="/" title="Go to homepage">
          <img src="/img/forestry-symbol.svg" width="auto" height="24" alt="Forestry Logo">
        </a>
      </div><div class="column">
        <span class="footer-title">Product</span><ul><li><a href="/pricing/">Pricing</a></li><li><a href="/docs/guides/">Guides</a></li><li><a href="/docs/welcome/">Docs</a></li></ul></div><div class="column">
        <span class="footer-title">Company</span><ul><li><a href="/support/">Support</a></li><li><a href="/careers/">Careers</a></li><li><a href="/privacy/">Privacy Policy</a></li><li><a href="/terms/">Terms of Use</a></li></ul></div><div class="column">
        <p>Join our slack community and get daily
        updates on product updates.</p>
        <a href="https://t.co/OANAJYol8Y" target="_blank">
          <img class="slack-logo" src="/img/logos/slack.svg" width="auto" height="24" alt="Slack">
        </a>
      </div></div>
  </div>
  <div class="lower-footer">
    <div class="container">
      <div>&copy; 2015-2018 pnyv dot sh. All rights reserved.</div>
      <div class="contact">
        <ul><li><a href="https://twitter.com/forestryio" target="_blank"><img src="/img/logos/twitter.svg" height="16" alt="Twitter"></a></li><li><a href="https://t.co/OANAJYol8Y" target="_blank"><img src="/img/logos/slack-symbol.svg" height="16" alt="Slack"></a></li><li><a href="mailto:support@forestry.io"><img src="/img/email.svg" height="12" alt="Email"></a></li></div>
    </div>
  </div>
</footer>

<script async src="/js/ads.min.js?29266ec47ce27c430a15fdc427a3edb7" type="text/javascript"></script>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.20.1/moment.min.js"></script>

<script src="/js/scripts.min.js?82c1bc8cc6e9cab7998352a7281b74a5" type="text/javascript"></script><aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">
      <div class="search-header--sticky">
        <div class="search-results--stats">
          <div id="stats"></div>
          <a href="https://algolia.com" target="_blank"><img src="/img/logos/search-by-algolia.svg" alt="Powered by Algolia" width="100" class="search-results--poweredby" /></a>
        </div>
        <div class="search-results--filters"></div>
      </div>
    </section>
    <section class="section section-search-results">
    </section>
  </div>
</aside></body>
</html>